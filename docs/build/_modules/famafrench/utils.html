

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>famafrench.utils &mdash; famafrench 0.1.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> famafrench
          

          
          </a>

          
            
            
              <div class="version">
                0.1.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../whatsnew/whatsnew.html">What's New?!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications/applications.html">Applications and Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wrdsconnection/wrdsconnection.html">Connecting to the WRDS cloud server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wrdscloudquery/wrdscloudquery.html">WRDS Query Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../portfolios/factorregressions.html">Estimating Market Betas and Rolling Residual Variances</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../portfolios/portfoliosorting.html">Constructing Portfolios and Return-Based Factors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kflibrary/kflibrary.html">Comparing to Ken French's Online Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../statistics-diagnostics/statistics.html">Summary Statistics and Diagnostics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils/utils.html">Auxiliary Functions and Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes/changes.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">famafrench</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>famafrench.utils</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for famafrench.utils</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This file is part of famafrench.</span>
<span class="sd">Copyright (c) 2020, Christian Jauregui &lt;chris.jauregui@berkeley.edu&gt;</span>
<span class="sd">See file LICENSE.txt for license information.</span>

<span class="sd">Filename</span>
<span class="sd">_________</span>
<span class="sd">`famafrench/utils.py`</span>

<span class="sd">Descriptions</span>
<span class="sd">____________</span>
<span class="sd">lru_cached_method</span>
<span class="sd">    Wrapper for methodtools.lru_cache(maxsize) that allows for sphinx documentation</span>
<span class="sd">    recognition of decorated instance methods.</span>
<span class="sd">get_kfpriorfactors_directly</span>
<span class="sd">    Directly download zipped datafiles from Ken French&#39;s online data library without the</span>
<span class="sd">    use of the &#39;pandas-datareader&#39; package. This method is used for a select few</span>
<span class="sd">    number of datafiles for which &#39;pandas-datareader&#39; returns an error.</span>
<span class="sd">timing</span>
<span class="sd">    Wrapper for class methods that are to be timed for speed and performance measurement.</span>
<span class="sd">any_in</span>
<span class="sd">    Provide a boolean variable that is =True if elements in a given set intersect with</span>
<span class="sd">    elements in another set, =False, otherwise.</span>
<span class="sd">priormonthToDay</span>
<span class="sd">    Using Fama and French&#39;s methodology, map the prior (j-k) monthly return strategy into</span>
<span class="sd">    a daily strategy (see online documentation provided on Ken French&#39;s website).</span>
<span class="sd">grouped_vwAvg</span>
<span class="sd">     Calculate weighted (net) portfolio return for a given portfolio with weights within a</span>
<span class="sd">     group or set of groups. This function is FASTER THAN groupby(...).apply(...) because it</span>
<span class="sd">     avoids non-optimized aggregation.</span>
<span class="sd">portRetAvg</span>
<span class="sd">    Compute a simple average across different columns.</span>
<span class="sd">get_statsTable</span>
<span class="sd">    Construct tables with formatted summary statistics.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Christian Jauregui &lt;chris.jauregui@berkeley.edu&#39;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;lru_cached_method&quot;</span><span class="p">,</span>
    <span class="s2">&quot;get_kfpriorfactors_directly&quot;</span><span class="p">,</span>
    <span class="s2">&quot;timing&quot;</span><span class="p">,</span>
    <span class="s2">&quot;any_in&quot;</span><span class="p">,</span>
    <span class="s2">&quot;priormonthToDay&quot;</span><span class="p">,</span>
    <span class="s2">&quot;grouped_vwAvg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;portRetAvg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;get_statsTable&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Standard Imports</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">methodtools</span> <span class="kn">import</span> <span class="n">lru_cache</span>  <span class="c1"># see documentation: https://pypi.org/project/methodtools/</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="c1"># Function: lru_cached_method(.,.):</span>
<div class="viewcode-block" id="lru_cached_method"><a class="viewcode-back" href="../../utils/generated/famafrench.utils.lru_cached_method.html#famafrench.utils.lru_cached_method">[docs]</a><span class="k">def</span> <span class="nf">lru_cached_method</span><span class="p">(</span><span class="o">*</span><span class="n">lru_args</span><span class="p">,</span> <span class="o">**</span><span class="n">lru_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for :func:`methodtools.lru_cache` enabling recognition of `decorated`</span>
<span class="sd">    class instance methods by `Sphinx &lt;https://www.sphinx-doc.org/en/master/&gt;`_.</span>

<span class="sd">    Parameters</span>
<span class="sd">    __________</span>
<span class="sd">    *lru_args : arbitrary</span>
<span class="sd">        Variable number of arguments to :func:`methodtools.lru_cache`</span>

<span class="sd">    **lru_kwargs : arbitrary</span>
<span class="sd">        Keyworded, variable-length argument list for :func:`methodtools.lru_cache`</span>

<span class="sd">    Returns</span>
<span class="sd">    _______</span>
<span class="sd">    decorator : arbitrary `wrapped` object</span>
<span class="sd">        Wrapped function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">wrapped_fn</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">wrapped_fn</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># Use a weak reference to self. This prevents a self-reference cycle that fools the garbage collector</span>
            <span class="c1"># into thinking the instance shouldn&#39;t be dropped when all external references are dropped.</span>
            <span class="n">weak_ref_to_self</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="nd">@wraps</span><span class="p">(</span><span class="n">wrapped_fn</span><span class="p">)</span>
            <span class="nd">@lru_cache</span><span class="p">(</span><span class="o">*</span><span class="n">lru_args</span><span class="p">,</span> <span class="o">**</span><span class="n">lru_kwargs</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">cached</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">wrapped_fn</span><span class="p">(</span><span class="n">weak_ref_to_self</span><span class="p">(),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrapped_fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">cached</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cached</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapped</span>
    <span class="k">return</span> <span class="n">decorator</span></div>


<span class="c1"># Function: get_kfpriorfactors_directly(.,.):</span>
<div class="viewcode-block" id="get_kfpriorfactors_directly"><a class="viewcode-back" href="../../utils/generated/famafrench.utils.get_kfpriorfactors_directly.html#famafrench.utils.get_kfpriorfactors_directly">[docs]</a><span class="k">def</span> <span class="nf">get_kfpriorfactors_directly</span><span class="p">(</span><span class="n">kflib_name</span><span class="p">,</span> <span class="n">kflib_freq</span><span class="p">,</span> <span class="n">kf_factor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Directly download (from Ken French&#39;s online library) zipped monthly or annual datafiles</span>
<span class="sd">    for the `Short-Term Reversal` or `Long-Term Reversal` Fama-French-style factors.</span>
<span class="sd">    This is required since the :meth:`pandas_datareader.web` method is broken for such datafiles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ___________</span>
<span class="sd">    kflib_name : str</span>
<span class="sd">        Name of zipped datafile.</span>
<span class="sd">    kflib_freq : str</span>
<span class="sd">        Observation frequency of factor portfolios. Possible choices are:</span>

<span class="sd">            * ``M``: monthly</span>
<span class="sd">            * ``A``: annual</span>
<span class="sd">    kf_factor : str</span>
<span class="sd">        The name or &quot;label&quot; of the Fama-French-style factor. Possible choices are:</span>

<span class="sd">            * ``ST_Rev`` : Short-Term Reversal - based on Prior (1-1) returns</span>
<span class="sd">            * ``LT_Rev`` : Long-Term Reversal - based on Prior (13-60) returns</span>

<span class="sd">    Returns</span>
<span class="sd">    ________</span>
<span class="sd">    kflib_data : pandas.DataFrame</span>
<span class="sd">        Dataset with time-series of the Fama-French-style factor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
    <span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span>
    <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>

    <span class="n">urllink</span> <span class="o">=</span> <span class="s2">&quot;http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/&quot;</span><span class="o">+</span><span class="n">kflib_name</span><span class="o">+</span><span class="s2">&quot;_CSV.zip&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">urllink</span><span class="p">)</span>

    <span class="c1"># Download Zipfile and create pandas.DataFrame</span>
    <span class="n">zipfile</span> <span class="o">=</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
    <span class="n">kflib_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">kflib_name</span><span class="o">+</span><span class="s2">&quot;.CSV&quot;</span><span class="p">),</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">kflib_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">:</span> <span class="s1">&#39;Date&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">kflib_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">rstrip</span><span class="p">,</span> <span class="n">kflib_data</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">kf_factor</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ST_Rev&#39;</span><span class="p">,</span> <span class="s1">&#39;LT_Rev&#39;</span><span class="p">]:</span>
        <span class="n">kf_factor</span> <span class="o">=</span> <span class="n">kf_factor</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

    <span class="c1"># Get first row number that has all values set to &quot;nan&quot; coinciding with the start of annual data</span>
    <span class="n">rows_with_all_nan</span> <span class="o">=</span> <span class="n">kflib_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">kflib_data</span><span class="p">[</span><span class="n">kf_factor</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
    <span class="n">diffrows_with_all_nan</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rows_with_all_nan</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rows_with_all_nan</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
    <span class="n">first_nan</span> <span class="o">=</span> <span class="n">rows_with_all_nan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">second_nan</span> <span class="o">=</span> <span class="n">rows_with_all_nan</span><span class="p">[</span><span class="n">diffrows_with_all_nan</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">diffrows_with_all_nan</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">kflib_freq</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
        <span class="n">kflib_data</span> <span class="o">=</span> <span class="n">kflib_data</span><span class="p">[:</span><span class="n">first_nan</span><span class="p">]</span>
        <span class="n">kflib_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">kflib_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kflib_freq</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
        <span class="n">kflib_data</span> <span class="o">=</span> <span class="n">kflib_data</span><span class="p">[</span><span class="n">first_nan</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">second_nan</span><span class="p">]</span>
        <span class="n">kflib_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">kflib_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">kflib_data</span> <span class="o">=</span> <span class="n">kflib_data</span><span class="p">[[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">kf_factor</span><span class="p">]]</span>
    <span class="n">kflib_data</span><span class="p">[</span><span class="n">kf_factor</span><span class="p">]</span> <span class="o">=</span> <span class="n">kflib_data</span><span class="p">[</span><span class="n">kf_factor</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">-</span><span class="mf">99.99</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kf_factor</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ST_Rev&#39;</span><span class="p">,</span> <span class="s1">&#39;LT_Rev&#39;</span><span class="p">]:</span>
        <span class="n">kflib_data</span> <span class="o">=</span> <span class="n">kflib_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">kf_factor</span><span class="p">:</span> <span class="n">kf_factor</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()})</span>
    <span class="n">kflib_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kflib_data</span></div>


<span class="c1"># Function: timing(.)</span>
<div class="viewcode-block" id="timing"><a class="viewcode-back" href="../../utils/generated/famafrench.utils.timing.html#famafrench.utils.timing">[docs]</a><span class="k">def</span> <span class="nf">timing</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for class instance methods enabling the timing of execution.</span>
<span class="sd">    Important for measuring speed and performance measurement.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ___________</span>
<span class="sd">    func : func</span>
<span class="sd">        Function to be wrapped and timed following execution.</span>

<span class="sd">    Returns</span>
<span class="sd">    ________</span>
<span class="sd">    wrapper : arbitrary `wrapped` object</span>
<span class="sd">        The wrapped result(s) for the function `func`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Elapsed time: &quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot; seconds.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">wrapper</span></div>


<span class="c1"># Function: any_in(.,.)</span>
<div class="viewcode-block" id="any_in"><a class="viewcode-back" href="../../utils/generated/famafrench.utils.any_in.html#famafrench.utils.any_in">[docs]</a><span class="k">def</span> <span class="nf">any_in</span><span class="p">(</span><span class="n">a_set</span><span class="p">,</span> <span class="n">b_set</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Boolean variable that is ``True`` if elements in a given set `a_set` intersect</span>
<span class="sd">    with elements in another set `b_set`. Otherwise, the boolean is ``False``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ___________</span>
<span class="sd">    a_set : list</span>
<span class="sd">        First set of elements.</span>
<span class="sd">    b_set : list</span>
<span class="sd">        Second set of elements.</span>

<span class="sd">    Returns</span>
<span class="sd">    ________</span>
<span class="sd">    not set(a_set).isdisjoint(b_set) : bool</span>
<span class="sd">        Boolean that is ``True`` if there is a non-empty intersection between both sets.</span>
<span class="sd">        Otherwise, the boolean is ``False``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">a_set</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="n">b_set</span><span class="p">)</span></div>


<span class="c1"># Function: priormonthToDay(.,.,.)</span>
<div class="viewcode-block" id="priormonthToDay"><a class="viewcode-back" href="../../utils/generated/famafrench.utils.priormonthToDay.html#famafrench.utils.priormonthToDay">[docs]</a><span class="k">def</span> <span class="nf">priormonthToDay</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">j_mth</span><span class="p">,</span> <span class="n">k_mth</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Consistent w/ Fama and French (2008, 2016), map the prior `(j-k)` monthly return strategy into a daily strategy</span>
<span class="sd">    (see `Ken French&#39;s online documentation  &lt;https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html&gt;`_).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ___________</span>
<span class="sd">    freq : str</span>
<span class="sd">        Frequency used to calculate prior `(j-k)` return strategy. Possible choices are:</span>

<span class="sd">            * ``D`` : daily</span>
<span class="sd">            * ``&#39;M`` : monthly</span>
<span class="sd">    j_mth : str</span>
<span class="sd">        Lagged month (or day) we start measuring stock performance.</span>
<span class="sd">    k_mth : str</span>
<span class="sd">        How many months (or days) are used in measuring stock performance.</span>

<span class="sd">    Returns</span>
<span class="sd">    ________</span>
<span class="sd">    j_per, k_per : tuple, str</span>
<span class="sd">        ``j_per = j_mth`` and ``k_per = k_mth`` if ``freq = M``.</span>
<span class="sd">        Otherwise, monthly figures mapped to daily periods using the description found on Ken French&#39;s online documentation:</span>

<span class="sd">            * `Daily Momentum &lt;https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/Data_Library/det_mom_factor_daily.html&gt;`_.</span>
<span class="sd">            * `Daily Short-Term Reversal &lt;https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/Data_Library/det_st_rev_factor_daily.html&gt;`_.</span>
<span class="sd">            * `Daily Long-Term Reversal &lt;https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/Data_Library/det_lt_rev_factor_daily.html&gt;`_.</span>

<span class="sd">    Note</span>
<span class="sd">    ____</span>
<span class="sd">    Monthly ``M`` (daily ``D``) strategies involve portfolios formed every month `t-1` (or day `t-1`)</span>
<span class="sd">    for month `t` (or day `t`).</span>

<span class="sd">    Note</span>
<span class="sd">    ____</span>
<span class="sd">    The Fama and French (2008, 2016) momentum strategy definition differs from that of Jegadeesh and Titman (1993).</span>
<span class="sd">    Jegadeesh and Titman (1993) consider **J/K** strategies, which include portfolios formed on stock performance over the previous</span>
<span class="sd">    **J** months (excluding the last week or month prior to portfolio formation, to remove the</span>
<span class="sd">    large short-horizon reversals associated with bid-ask bounce) and hold portfolios for **K** months, where **J**, **K** :math:`\in` {3,6,9,12}.</span>
<span class="sd">    Future updates to this module will extend this package to include these additional momentum strategies.</span>


<span class="sd">    References</span>
<span class="sd">    ___________</span>
<span class="sd">    *   Fama, Eugene F., and Kenneth R. French. (2008). `Dissecting Anomalies`,</span>
<span class="sd">        Journal of Finance, 48(4), pp.1653-1678</span>

<span class="sd">    *   Fama, Eugene F., and Kenneth R. French. (2016). `Dissecting Anomalies with a Five-Factor Model`,</span>
<span class="sd">        Journal of Finance, 48(4), pp.1653-1678</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Per Fama and French, map prior (2-12), (1-1), and (13-60) returns</span>
    <span class="c1"># at the monthly frequency to the daily frequency</span>
    <span class="k">if</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">j_mth</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k_mth</span> <span class="o">==</span> <span class="s1">&#39;12&#39;</span><span class="p">):</span>
            <span class="n">j_per</span><span class="p">,</span> <span class="n">k_per</span> <span class="o">=</span> <span class="s1">&#39;21&#39;</span><span class="p">,</span> <span class="s1">&#39;250&#39;</span>
            <span class="k">return</span> <span class="n">j_per</span><span class="p">,</span> <span class="n">k_per</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">j_mth</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k_mth</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">):</span>
            <span class="n">j_per</span><span class="p">,</span> <span class="n">k_per</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span>
            <span class="k">return</span> <span class="n">j_per</span><span class="p">,</span> <span class="n">k_per</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">j_mth</span> <span class="o">==</span> <span class="s1">&#39;13&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k_mth</span> <span class="o">==</span> <span class="s1">&#39;60&#39;</span><span class="p">):</span>
            <span class="n">j_per</span><span class="p">,</span> <span class="n">k_per</span> <span class="o">=</span> <span class="s1">&#39;251&#39;</span><span class="p">,</span> <span class="s1">&#39;1250&#39;</span>
            <span class="k">return</span> <span class="n">j_per</span><span class="p">,</span> <span class="n">k_per</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">prior (j-k)</span><span class="se">\&#39;</span><span class="s1"> return strategy not of the standard Fama and French type.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]:</span>
        <span class="n">j_per</span><span class="p">,</span> <span class="n">k_per</span> <span class="o">=</span> <span class="n">j_mth</span><span class="p">,</span> <span class="n">k_mth</span>
        <span class="k">return</span> <span class="n">j_per</span><span class="p">,</span> <span class="n">k_per</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please specify one of the following frequencies: </span><span class="se">\&#39;</span><span class="s1">D</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">M</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span></div>


<span class="c1"># Function: grouped_vwAvg(.,.,.,.,.)</span>
<div class="viewcode-block" id="grouped_vwAvg"><a class="viewcode-back" href="../../utils/generated/famafrench.utils.grouped_vwAvg.html#famafrench.utils.grouped_vwAvg">[docs]</a><span class="k">def</span> <span class="nf">grouped_vwAvg</span><span class="p">(</span><span class="n">df0</span><span class="p">,</span> <span class="n">col_values</span><span class="p">,</span> <span class="n">col_weights</span><span class="p">,</span> <span class="o">*</span><span class="n">groupby_args</span><span class="p">,</span> <span class="o">**</span><span class="n">groupby_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate (net) weighted portfolio return for portfolio with weights ``col_weights`` within a group or groups.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ___________</span>
<span class="sd">    df0 : pandas.DataFrame</span>
<span class="sd">        Dataset containing firm-level stock returns and portfolio weights, both indexed by dates and firm identifiers when required.</span>
<span class="sd">    col_values : list, str</span>
<span class="sd">        Column(s) to average over.</span>
<span class="sd">    col_weights : str</span>
<span class="sd">        Column containing the portfolio weights.</span>
<span class="sd">    group_args : list, str, [optional]</span>
<span class="sd">        args to pass into `groupby` (ie the level to group on).</span>
<span class="sd">    group_kwargs : list, str, [optional]</span>
<span class="sd">        kwargs to pass into `groupby`.</span>

<span class="sd">    Returns</span>
<span class="sd">    ________</span>
<span class="sd">    df1 : pandas.Series, or pandas.DataFrame</span>
<span class="sd">        Original dataset augmented w/ value-weighted returns.</span>

<span class="sd">    Note</span>
<span class="sd">    ____</span>
<span class="sd">    Function is **FASTER** than :func:`pandas.core.groupby.GroupBy.apply` since it avoids non-optimized aggregation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col_values</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">col_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_values</span><span class="p">]</span>

    <span class="n">ss</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">col_values</span><span class="p">:</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">df0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">value_x_weight</span> <span class="o">=</span> <span class="s1">&#39;product_</span><span class="si">{v}</span><span class="s1">_</span><span class="si">{w}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">col_weights</span><span class="p">)</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="s1">&#39;weights_</span><span class="si">{w}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="n">col_weights</span><span class="p">)</span>

        <span class="n">df1</span><span class="p">[</span><span class="n">value_x_weight</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="n">df1</span><span class="p">[</span><span class="n">col_weights</span><span class="p">]</span>
        <span class="n">df1</span><span class="p">[</span><span class="n">weights</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">col_weights</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">df1</span><span class="p">[</span><span class="n">value_x_weight</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="o">*</span><span class="n">groupby_args</span><span class="p">,</span> <span class="o">**</span><span class="n">groupby_kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">value_x_weight</span><span class="p">]</span> <span class="o">/</span> <span class="n">df1</span><span class="p">[</span><span class="n">weights</span><span class="p">]</span>

        <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">ss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">ss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df1</span></div>


<span class="c1"># Function: portRetAvg(.)</span>
<div class="viewcode-block" id="portRetAvg"><a class="viewcode-back" href="../../utils/generated/famafrench.utils.portRetAvg.html#famafrench.utils.portRetAvg">[docs]</a><span class="k">def</span> <span class="nf">portRetAvg</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute a simple average across different columns.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ___________</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        Dataset with columns to average over.</span>

<span class="sd">    Returns</span>
<span class="sd">    ________</span>
<span class="sd">    dfavg : pandas.DataFrame</span>
<span class="sd">        Dataset with the averaged columns.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dfavg</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dfavg</span></div>


<span class="c1"># Function: get_statsTable(.,.,.,.)</span>
<div class="viewcode-block" id="get_statsTable"><a class="viewcode-back" href="../../utils/generated/famafrench.utils.get_statsTable.html#famafrench.utils.get_statsTable">[docs]</a><span class="k">def</span> <span class="nf">get_statsTable</span><span class="p">(</span><span class="n">dType</span><span class="p">,</span> <span class="n">dFreq</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">dates_as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ptiles</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct detailed tables with summary statistics.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ___________</span>
<span class="sd">    dType : str</span>
<span class="sd">        Dataset type of the portfolios. Possible choices are:</span>

<span class="sd">            * ``Returns``</span>
<span class="sd">            * ``Factors``</span>
<span class="sd">            * ``NumFirms``</span>
<span class="sd">            * ``Characs``</span>
<span class="sd">    dFreq : str</span>
<span class="sd">        Observation frequency of the portfolios. Possible choices are:</span>

<span class="sd">            * ``D`` : daily</span>
<span class="sd">            * ``W`` : weekly</span>
<span class="sd">            * ``M`` : monthly</span>
<span class="sd">            * ``Q`` : quarterly (3-months)</span>
<span class="sd">            * ``A`` : annual</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        Dataset w/ portfolio returns (which may include factor returns), number of firms in each portfolio,</span>
<span class="sd">        or `average` anomaly portfolio characteristics for a given portfolio sorting strategy.</span>
<span class="sd">    dates_as_index : bool</span>
<span class="sd">        Flag determining whether ``df`` has a :class:`pandas.DatetimeIndex` index (``dates_as_index = True``).</span>
<span class="sd">        Otherwise, ``dates_as_index = False``.</span>
<span class="sd">    ptiles : list, float, default None</span>
<span class="sd">        List of percentiles (in decimal format) included as part of output results.</span>
<span class="sd">        If ``None``, then ``ptiles = [0.01, 0.1, 0.25, 0.5, 0.75, 0.9, 0.99]``.</span>


<span class="sd">    Returns</span>
<span class="sd">    ________</span>
<span class="sd">    statsTable : pandas.DataFrame</span>
<span class="sd">        Summary statistics of the dataset including the following:</span>

<span class="sd">            * number of observations :meth:`pandas.DataFrame.count`</span>
<span class="sd">            * sample mean :meth:`pandas.DataFrame.mean`</span>
<span class="sd">            * sample standard deviation :meth:`pandas.DataFrame.std`</span>
<span class="sd">            * sample min :meth:`pandas.DataFrame.min`</span>
<span class="sd">            * sample max :meth:`pandas.DataFrame.max`</span>
<span class="sd">            * sample skewness :meth:`pandas.DataFrame.skew`</span>
<span class="sd">            * sample kurtosis :meth:`pandas.DataFrame.kurtosis`</span>
<span class="sd">            * sample mean absolute deviation :meth:`pandas.DataFrame.mad`</span>
<span class="sd">            * sample percentiles :meth:`numpy.percentile`</span>

<span class="sd">        If ``dates_as_index = True``, then the table also includes the starting and ending date for each observation type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ptiles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ptiles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">]</span>
    <span class="n">statsTable</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="n">ptiles</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">statsTable</span> <span class="o">=</span> <span class="n">statsTable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">statsTable</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;skew&#39;</span><span class="p">,</span> <span class="s1">&#39;kurt&#39;</span><span class="p">,</span> <span class="s1">&#39;mad&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Find starting and ending date of each observation type</span>
    <span class="k">if</span> <span class="n">dates_as_index</span><span class="p">:</span>
        <span class="n">statsTable0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;startdate&#39;</span><span class="p">,</span> <span class="s1">&#39;enddate&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">sdate</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">first_valid_index</span><span class="p">()</span>
            <span class="n">edate</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">statsTable0</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;startdate&#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">sdate</span>
            <span class="n">statsTable0</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;enddate&#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">edate</span>
        <span class="n">statsTable</span> <span class="o">=</span> <span class="n">statsTable0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">statsTable</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Factors&#39;</span><span class="p">,</span> <span class="s1">&#39;Returns&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">dates_as_index</span><span class="p">:</span>
            <span class="n">statsTable</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">statsTable</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">statsTable</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">statsTable</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
        <span class="n">statsTable</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">statsTable</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dType</span> <span class="o">==</span> <span class="s1">&#39;NumFirms&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">statsTable</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dates_as_index</span><span class="p">:</span>
                <span class="n">statsTable</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">statsTable</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">statsTable</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">statsTable</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">statsTable</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">statsTable</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    *********************** Observation frequency: &#39;</span><span class="o">+</span><span class="n">dFreq</span><span class="o">+</span><span class="s1">&#39; ************************&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">statsTable</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">statsTable</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Christian Jauregui

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>